<h1>Iscogram</h1>

<div class="header">
  <% if user[:id] != 0 %>
  <%=  escape_html user[:account_name] %>さん
  <% else %>
  ログイン前
  <% end %>
</div>

<div class="isu-submit">
  <form method="post" action="/" enctype="multipart/form-data">
    <div class="isu-form">
      <input type="file" name="file" value="file">
    </div>
    <div class="isu-form">
      <textarea name="body"></textarea>
    </div>
    <div class="form-submit">
      <input type="hidden" name="csrf_token" value="<%= escape_html session.id %>">
      <input type="submit" name="submit" value="submit">
    </div>
  </form>
</div>

<div>
  <% posts.each do |p| %>
  <div class="isu-post" data-post-id="<%= p[:id] %>" data-post-user-id="<%= p[:user_id] %>">
    <div class="isu-post-image">
      <img src="/image/<%= p[:id] %>" class="isu-image">
    </div>
    <div class="isu-post-text">
      <%= escape_html(p[:body]).gsub(/\r?\n/, '<br>') %>
    </div>
    <div class="isu-post-comment">
      <% if comments[p[:id]] %>
      <%   comments[p[:id]].each do |c| %>
      <div class="isu-comment-text" data-comment-id="<%= c[:id] %>" data-comment-user-id=<%= c[:user_id] %>>
        <%= escape_html(c[:comment]) %>
      </div>
      <%   end %>
      <% end %>
      <form method="post" action="/comment">
        <input type="text" name="comment">
        <input type="hidden" name="post_id" value="<%= p[:id] %>">
        <input type="hidden" name="csrf_token" value="<%= escape_html session.id %>">
        <input type="submit" name="submit" value="submit">
      </form>
    </div>
  </div>
  <% end %>
</div>
